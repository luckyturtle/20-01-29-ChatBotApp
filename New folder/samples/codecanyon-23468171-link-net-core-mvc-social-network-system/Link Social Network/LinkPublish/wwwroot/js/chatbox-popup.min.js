function close_popup(n){for(var t=0;t<popups.length;t++)if(n==popups[t]){Array.remove(popups,t);document.getElementById(n).style.display="none";window["popup-comment-"+n]=null;calculate_popups();return}}function display_popups(){var i=220,n,r,t;for($(window).width()<600&&(i=30),n=0,n;n<total_popups;n++)popups[n]!=undefined&&(t=document.getElementById(popups[n]),t.style.right=i+"px",i=i+320,t.style.display="block");for(r=n;r<popups.length;r++)t=document.getElementById(popups[r]),t.style.display="none"}function register_popup(n,t,i,r,u){for(var f,e=0;e<popups.length;e++)if(n==popups[e]){Array.remove(popups,e);popups.unshift(n);calculate_popups();return}f='<div class="popup-box chat-popup" id="'+n+'">';f=f+'<div class="popup-head">';f=f+'<div class="popup-head-left">'+t+"<\/div>";f=f+'<div class="popup-head-right"><a href="javascript:close_popup(\''+n+"');\">&#10005;<\/a><\/div>";f=f+'<div style="clear: both"><\/div><\/div><div class=" scrollbar popup-messages" id="popup-comment-'+n+'"><\/div><br><\/div>';document.getElementsByTagName("footer")[0].insertAdjacentHTML("beforeend",f);popups.unshift(n);calculate_popups();$.ajax({type:"put",url:i+"/api/Notifications/setNotificationAsRead/"+n+"/1",success:function(){$.ajax({type:"get",url:i+"/api/Notifications/notificationsNo/1",success:function(n){$(".chat-notification-num").text(n)}})}});window["popup-comment-"+n]=$("#popup-comment-"+n).chatComments({textareaPlaceholderText:"Leave a message",creator:r,rootUrl:i,filePath:i+"/Comments/DownloadAttachment/",commentProfilePicturePath:i+"/Profile/GetUserProfile/",fieldMappings:{id:"id",parent:"parent",created:"created",modified:"modified",content:"content",file:"file",fileURL:"fileURL",fileMimeType:"fileMimeType",pings:"pings",creator:"creator",fullname:"fullname",profileURL:"profileURL",profilePictureURL:"profilePictureURL",isNew:"isNew",createdByAdmin:"createdByAdmin",createdByCurrentUser:"createdByCurrentUser",upvoteCount:"upvoteCount",userHasUpvoted:"userHasUpvoted"},refresh:function(){$("#popup-comment-"+n).addClass("rendered")},getUsers:function(n,t){$.ajax({type:"get",url:i+"/api/users/",success:function(t){n(t)},error:t})},hashtagClicked:function(n){var t=window.open(i+"/Comments/Hashtag/"+n,"_blank");t.focus()},loadMoreComments:function(t){$.ajax({type:"get",url:i+"/api/comments/"+n+"/"+u+"/"+t.options.commentCount,success:function(n){n.length>=5&&$.each(n,function(n,i){t.prependNewComment(i)})},async:!1})},getComments:function(t,r){$.ajax({type:"get",url:i+"/api/comments/"+n+"/"+u+"/0",success:function(i){t(i);$("#popup-comment-"+n).scrollTop($("#popup-comment-"+n)[0].scrollHeight)},error:r,async:!1})},postComment:function(t,r,f){t.groupId=n;t.commentGroupTypeId=u;$.ajax({type:"post",url:i+"/api/comments/",data:t,success:function(t){r(t);$("#popup-comment-"+n).scrollTop($("#popup-comment-"+n)[0].scrollHeight)},error:f})},putComment:function(t,r,f){t.groupId=n;t.commentGroupTypeId=u;$.ajax({type:"put",url:i+"/api/comments/"+t.id,data:t,success:function(n){r(n)},error:f})},deleteComment:function(n,t,r){$.ajax({type:"delete",url:i+"/api/comments/"+n.id,success:t,error:r})},upvoteComment:function(n,t,r){var u=i+"/api/comments/"+n.id,f=u+"/upvotes/",e=n.userHasUpvoted==!0?1:0;$.ajax({type:"put",url:f+e,success:function(){t(n)},error:r})},downloadAttachment:function(n){var t=window.open(i+"/Comments/DownloadAttachment/"+n.id,"_blank");t.focus()},uploadAttachments:function(t,r,f){$(t).each(function(t,e){var s=new FormData,o;$(Object.keys(e)).each(function(n,t){var i=e[t];i&&s.append(t,i)});o=e;o.file=null;$.ajax({rootUrl:i,url:i+"/api/comments/Upload/",type:"post",data:s,cache:!1,contentType:!1,processData:!1,success:function(t){o.fileURL=t;o.groupId=n;o.commentGroupTypeId=u;$.ajax({url:i+"/api/comments/",type:"post",data:o,success:function(t){r(t);$("#popup-comment-"+n).scrollTop($("#popup-comment-"+n)[0].scrollHeight)},error:f})},error:function(){}})})}})}function calculate_popups(){var n=window.innerWidth;n<540?total_popups=1:(n=n-200,total_popups=parseInt(n/320));display_popups()}Array.remove=function(n,t,i){var r=n.slice((i||t)+1||n.length);return n.length=t<0?n.length+t:t,n.push.apply(n,r)};var total_popups=0,popups=[];window.addEventListener("resize",calculate_popups);window.addEventListener("load",calculate_popups);